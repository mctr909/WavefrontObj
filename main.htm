<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//JP">
<html lang="ja">
<meta charset="utf-8">
<html>
	<head>
		<script type="text/javascript" src="common/math.js"></script>
		<script type="text/javascript" src="common/model.js"></script>
		<script type="text/javascript" src="common/render.js"></script>
		<script type="text/javascript" src="common/drawer.js"></script>
		<script type="text/javascript" src="common/viewpad.js"></script>
		<script type="text/javascript" src="common/geometry.js"></script>
		<script type="text/javascript" src="draw.js"></script>
		<script type="text/javascript" src="main.js"></script>
		<script type="text" id="vs">
			attribute vec3 vertex;
			uniform   mat4 mvpMatrix;
			uniform   mat4 mMatrix;
			varying   vec3 vVertex;

			void main(void){
				vVertex = (mMatrix * vec4(vertex, 1.0)).xyz;
				gl_Position = mvpMatrix * vec4(vertex, 1.0);
			}
		</script>
		<script type="text" id="fs">
			#extension GL_OES_standard_derivatives : enable
			precision mediump float;

			uniform mat4 invMatrix;
			uniform vec4 color;
			uniform vec3 lightPosition;
			uniform vec3 eyePosition;
			uniform vec4 ambientColor;
			varying vec3 vVertex;

			void main(void){
				vec3  lightVec = lightPosition - vVertex;
				vec3  invLight = normalize(invMatrix * vec4(lightVec, 0.0)).xyz;
				vec3  invEye   = normalize(invMatrix * vec4(eyePosition, 0.0)).xyz;
				vec3  halfLE   = normalize(invLight + invEye);
				vec3  dx = dFdx(vVertex);
				vec3  dy = dFdy(vVertex);
				vec3  normal   = normalize(cross(normalize(dx), normalize(dy)));
				float diffuse  = clamp(dot(normal, invLight), 0.0, 1.0) * 0.8 + 0.2;
				float specular = pow(clamp(dot(normal, halfLE), 0.0, 1.0), 100.0);
				gl_FragColor   = color * vec4(vec3(diffuse), 1.0) + vec4(vec3(specular), 1.0) + ambientColor;
			}
		</script>
	</head>
	<body>
		<table>
			<tr>
				<td rowspan="2"><canvas id="canvas"></canvas></td>
				<td><span id="disp"></span><br/>スケール<br><input id="scale" type="range" value="100" min="1" max="5000" style="width:256px;"></td>
			</tr>
			<tr>
				<td>カメラ操作<br><canvas id="viewpad"></canvas></td>
			</tr>
		</table>
	</body>
</html>
